<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Together - Share Videos & Chat</title>
    <meta name="description" content="Watch videos together with friends in real-time. Share YouTube, Vimeo, and direct video links with synchronized playback and live chat.">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Modern Typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¬</text></svg>">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <!-- Username Modal -->
    <div class="username-modal" id="username-modal">
        <div class="modal-content">
            <h2><i class="fas fa-user-circle"></i> Join the Room</h2>
            <p class="modal-desc">
                Enter your name to start watching and chatting with others
            </p>
            <input type="text" id="username-input" placeholder="Your display name..." autocomplete="name" maxlength="20">
            <button id="username-submit">
                <i class="fas fa-sign-in-alt"></i>
                Join Chat
            </button>
        </div>
    </div>
    
    <!-- Admin Request Modal -->
    <div class="admin-request-modal" id="admin-request-modal">
        <div class="modal-content">
            <h2><i class="fas fa-crown"></i> Admin Request</h2>
            <p id="admin-request-message" class="admin-msg"></p>
            <div class="btn-container">
                <button id="accept-admin-request">
                    <i class="fas fa-check"></i>
                    Accept
                </button>
                <button id="reject-admin-request">
                    <i class="fas fa-times"></i>
                    Decline
                </button>
            </div>
        </div>
    </div>

    <!-- Invite Modal -->
    <div class="invite-modal" id="invite-modal">
        <div class="modal-content">
            <button class="modal-close" id="close-invite-modal">
                <i class="fas fa-times"></i>
            </button>
            <h2><i class="fas fa-user-plus"></i> Invite Friends to Room</h2>
            <p class="admin-msg">
                Share this link with friends to invite them to watch together
            </p>
            
            <!-- Invite Link Display -->
            <div class="invite-link-container">
                <div class="invite-link-display">
                    <input type="text" id="invite-link" readonly placeholder="Generate an invite link">
                    <button id="copy-invite-link" class="copy-btn" disabled>
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                <div class="invite-actions">
                    <button id="generate-invite" class="primary-btn">
                        <i class="fas fa-link"></i>
                        Generate Invite Link
                    </button>
                    <button id="revoke-invite" class="secondary-btn hidden">
                        <i class="fas fa-times-circle"></i>
                        Revoke Link
                    </button>
                </div>
            </div>

            <!-- Share Options -->
            <div class="share-options">
                <h3>Share via:</h3>
                <div class="share-buttons">
                    <button class="share-btn" onclick="shareViaWhatsApp()">
                        <i class="fab fa-whatsapp"></i>
                        WhatsApp
                    </button>
                    <button class="share-btn" onclick="shareViaDiscord()">
                        <i class="fab fa-discord"></i>
                        Discord
                    </button>
                    <button class="share-btn" onclick="shareViaEmail()">
                        <i class="fas fa-envelope"></i>
                        Email
                    </button>
                    <button class="share-btn" onclick="shareViaTwitter()">
                        <i class="fab fa-twitter"></i>
                        Twitter
                    </button>
                </div>
            </div>

            <!-- Invite Statistics -->
            <div class="invite-stats hidden" id="invite-stats">
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <span>Expires: <span id="invite-expires">Never</span></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-link"></i>
                    <span>Link Status: <span id="invite-status">Active</span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-container">
        <!-- Chat Section -->
        <div class="chat-section">
            <!-- Chat Header - Compact Design -->
            <div class="chat-header-compact">
                <div class="chat-header-left">
                    <div class="chat-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="chat-info">
                        <span class="chat-title">Live Chat</span>
                        <span class="online-users" id="online-users">0 users online</span>
                    </div>
                </div>
                <div class="chat-header-right" id="user-info-compact">
                    <!-- User info will be inserted here by JavaScript -->
                </div>
            </div>
            
            <!-- Messages Container -->
            <div class="chat-container">
                <ul id="messages"></ul>
            </div>
            
            <!-- Message Input Form -->
            <form id="form" action="">
                <!-- Single Input Row with Voice, Message, and Send -->
                <div class="message-input-container">
                    <!-- Voice Chat Button -->
                    <button type="button" id="voice-chat-toggle" class="voice-chat-btn" title="Toggle voice chat">
                        <i class="fas fa-microphone"></i>
                    </button>
                    
                    <!-- Message Input -->
                    <input id="input" autocomplete="off" placeholder="Type a message..." maxlength="500" />
                    
                    <!-- Send Button -->
                    <button type="submit" id="send" title="Send message">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </form>
        </div>
        <!-- Video Section -->
        <div class="video-section">
            <!-- Video Player Container -->
            <div class="video-container">
                <!-- Admin Notice -->
                <div class="admin-notice" id="admin-notice"></div>
                
                <!-- Video Type Badge -->
                <div class="video-type-badge hidden" id="video-type-badge"></div>
                
                <!-- Admin Viewing Notice -->
                <div class="admin-viewing-notice" id="admin-viewing-notice">
                    <i class="fas fa-crown"></i>
                    Admin is controlling playback
                </div>
                
                <!-- Video Players -->
                <video id="direct-video-player" controls class="video-player">
                    <source src="" type="video/mp4">
                    <p class="video-msg">
                        Your browser does not support HTML5 video. Please try a different browser or video format.
                    </p>
                </video>
                
                <iframe id="video-player" src="" frameborder="0" class="video-player"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen></iframe>
            </div>
            
            <!-- Video Controls -->
            <div class="video-controls">
                <input type="text" class="video-url-input" id="video-url" 
                    placeholder="Paste any video URL (YouTube, Vimeo, direct MP4, etc.)" 
                    maxlength="2000">
                <button class="change-video-btn" id="change-video">
                    <i class="fas fa-play"></i>
                    Load Video
                </button>
            </div>
            
            <!-- Admin Controls Panel -->
            <div class="admin-controls" id="admin-controls">
                <p>
                    <i class="fas fa-crown"></i>
                    Video Controls
                </p>
                <div class="admin-video-controls">
                    <button id="admin-play" class="admin-btn">
                        <i class="fas fa-play"></i> 
                        Play for All
                    </button>
                    <button id="admin-pause" class="admin-btn">
                        <i class="fas fa-pause"></i> 
                        Pause for All
                    </button>
                    <button id="admin-restart" class="admin-btn">
                        <i class="fas fa-redo"></i> 
                        Restart Video
                    </button>
                </div>
                
                <!-- Room Management Controls -->
                <div class="room-management-controls">
                    <button id="invite-button" class="admin-btn invite-btn">
                        <i class="fas fa-user-plus"></i>
                        Invite Friends
                    </button>
                    <button id="room-settings" class="admin-btn settings-btn">
                        <i class="fas fa-cog"></i>
                        Room Settings
                    </button>
                </div>
                
                <!-- System Message Settings -->
                <div class="system-message-settings">
                    <p class="chat-timestamp">
                        <i class="fas fa-comment-dots"></i>
                        Chat Notifications
                    </p>
                    <div class="settings-toggles">
                        <label class="toggle-label">
                            <input type="checkbox" id="toggle-join-leave" checked>
                            <span class="toggle-text">Join/Leave messages</span>
                        </label>
                        <label class="toggle-label">
                            <input type="checkbox" id="toggle-admin-change" checked>
                            <span class="toggle-text">Admin change messages</span>
                        </label>
                        <label class="toggle-label">
                            <input type="checkbox" id="toggle-video-change" checked>
                            <span class="toggle-text">Video change messages</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Request Admin Button -->
            <div id="request-admin-container">
                <button class="request-admin-btn" id="request-admin">
                    <i class="fas fa-hand-paper"></i>
                    Request Control
                </button>
            </div>
            
            <!-- Video History -->
            <div class="video-history-btn-container">
                <button id="video-history-btn" class="video-history-btn">
                    <i class="fas fa-history"></i> 
                    Video History
                </button>
                <div id="video-history" class="video-history-container"></div>
            </div>
        </div>
    </div>
    
    <!-- Include Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- Include platform-specific API scripts -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://player.vimeo.com/api/player.js"></script>
    <!-- Link to external JavaScript file -->
    <script src="/js/main.js"></script>
</body>
</html>